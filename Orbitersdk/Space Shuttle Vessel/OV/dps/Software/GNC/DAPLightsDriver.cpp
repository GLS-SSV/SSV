/******* SSV File Modification Notice *******
Date         Developer
2020/06/20   GLS
2021/08/23   GLS
2021/08/24   GLS
2022/06/16   GLS
2022/09/29   GLS
2022/12/23   GLS
********************************************/
#include "DAPLightsDriver.h"
#include "../../../Atlantis.h"


namespace dps
{
	DAPLightsDriver::DAPLightsDriver( SimpleGPCSystem *_gpc ):SimpleGPCSoftware( _gpc, "DAPLightsDriver" )
	{
		return;
	}

	DAPLightsDriver::~DAPLightsDriver( void )
	{
		return;
	}

	void DAPLightsDriver::OnPostStep( double simt, double simdt, double mjd )
	{
		unsigned short FF1_IOM2_CH1 = 0;
		if (ReadCOMPOOL_IS( SCP_FWD_DAP_AUTO_LT ) == 1) FF1_IOM2_CH1 |= 0x2000;
		if (ReadCOMPOOL_IS( SCP_FWD_DAP_SELECT_A_LT ) == 1) FF1_IOM2_CH1 |= 0x4000;
		if (ReadCOMPOOL_IS( SCP_FWD_DAP_MAN_LVLH_LT ) == 1) FF1_IOM2_CH1 |= 0x8000;

		unsigned short FF1_IOM2_CH2 = 0;
		if (ReadCOMPOOL_IS( SCP_FWD_DAP_MAN_INRTL_LT ) == 1) FF1_IOM2_CH2 |= 0x0008;
		if (ReadCOMPOOL_IS( SCP_FWD_DAP_SELECT_B_LT ) == 1) FF1_IOM2_CH2 |= 0x0010;
		if (ReadCOMPOOL_IS( SCP_FWD_DAP_MAN_FREE_DFT_LT ) == 1) FF1_IOM2_CH2 |= 0x0020;

		unsigned short FF1_IOM10_CH1 = 0;
		if (ReadCOMPOOL_IS( SCP_FWD_RCS_JETS_NORM_LT ) == 1) FF1_IOM10_CH1 |= 0x0002;
		if (ReadCOMPOOL_IS( SCP_FWD_ROT_ROLL_DISC_LT ) == 1) FF1_IOM10_CH1 |= 0x0004;
		if (ReadCOMPOOL_IS( SCP_FWD_ROT_ROLL_PULSE_LT ) == 1) FF1_IOM10_CH1 |= 0x0008;
		if (ReadCOMPOOL_IS( SCP_FWD_ALT_PRCS_MODE_LT ) == 1) FF1_IOM10_CH1 |= 0x0010;
		if (ReadCOMPOOL_IS( SCP_FWD_ROT_PITCH_DISC_LT ) == 1) FF1_IOM10_CH1 |= 0x0020;
		if (ReadCOMPOOL_IS( SCP_FWD_ROT_PITCH_PULSE_LT ) == 1) FF1_IOM10_CH1 |= 0x0040;
		if (ReadCOMPOOL_IS( SCP_FWD_RCS_JETS_VERN_LT ) == 1) FF1_IOM10_CH1 |= 0x0080;
		if (ReadCOMPOOL_IS( SCP_FWD_ROT_YAW_DISC_LT ) == 1) FF1_IOM10_CH1 |= 0x0100;
		if (ReadCOMPOOL_IS( SCP_FWD_ROT_YAW_PULSE_LT ) == 1) FF1_IOM10_CH1 |= 0x0200;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_X_NORM_LT ) == 1) FF1_IOM10_CH1 |= 0x0400;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_X_PULSE_LT ) == 1) FF1_IOM10_CH1 |= 0x0800;
		if (ReadCOMPOOL_IS( SCP_FWD_BLANK_LT ) == 1) FF1_IOM10_CH1 |= 0x1000;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_Y_NORM_LT ) == 1) FF1_IOM10_CH1 |= 0x2000;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_Y_PULSE_LT ) == 1) FF1_IOM10_CH1 |= 0x4000;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_LOW_Z_LT ) == 1) FF1_IOM10_CH1 |= 0x8000;

		unsigned short FF1_IOM10_CH2 = 0;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_Z_NORM_LT ) == 1) FF1_IOM10_CH2 |= 0x0001;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_Z_PULSE_LT ) == 1) FF1_IOM10_CH2 |= 0x0002;
		if (ReadCOMPOOL_IS( SCP_FWD_TRANSL_Z_HIGH_LT ) == 1) FF1_IOM10_CH2 |= 0x0004;

		unsigned short FF3_IOM2_CH1 = 0;
		if (ReadCOMPOOL_IS( SCP_AFT_DAP_AUTO_LT ) == 1) FF3_IOM2_CH1 |= 0x2000;
		if (ReadCOMPOOL_IS( SCP_AFT_DAP_SELECT_A_LT ) == 1) FF3_IOM2_CH1 |= 0x4000;
		if (ReadCOMPOOL_IS( SCP_AFT_DAP_MAN_LVLH_LT ) == 1) FF3_IOM2_CH1 |= 0x8000;

		unsigned short FF3_IOM2_CH2 = 0;
		if (ReadCOMPOOL_IS( SCP_AFT_DAP_MAN_INRTL_LT ) == 1) FF3_IOM2_CH2 |= 0x0008;
		if (ReadCOMPOOL_IS( SCP_AFT_DAP_SELECT_B_LT ) == 1) FF3_IOM2_CH2 |= 0x0010;
		if (ReadCOMPOOL_IS( SCP_AFT_DAP_MAN_FREE_DFT_LT ) == 1) FF3_IOM2_CH2 |= 0x0020;

		unsigned short FF3_IOM10_CH1 = 0;
		if (ReadCOMPOOL_IS( SCP_AFT_RCS_JETS_NORM_LT ) == 1) FF3_IOM10_CH1 |= 0x0002;
		if (ReadCOMPOOL_IS( SCP_AFT_ROT_ROLL_DISC_LT ) == 1) FF3_IOM10_CH1 |= 0x0004;
		if (ReadCOMPOOL_IS( SCP_AFT_ROT_ROLL_PULSE_LT ) == 1) FF3_IOM10_CH1 |= 0x0008;
		if (ReadCOMPOOL_IS( SCP_AFT_ALT_PRCS_MODE_LT ) == 1) FF3_IOM10_CH1 |= 0x0010;
		if (ReadCOMPOOL_IS( SCP_AFT_ROT_PITCH_DISC_LT ) == 1) FF3_IOM10_CH1 |= 0x0020;
		if (ReadCOMPOOL_IS( SCP_AFT_ROT_PITCH_PULSE_LT ) == 1) FF3_IOM10_CH1 |= 0x0040;
		if (ReadCOMPOOL_IS( SCP_AFT_RCS_JETS_VERN_LT ) == 1) FF3_IOM10_CH1 |= 0x0080;
		if (ReadCOMPOOL_IS( SCP_AFT_ROT_YAW_DISC_LT ) == 1) FF3_IOM10_CH1 |= 0x0100;
		if (ReadCOMPOOL_IS( SCP_AFT_ROT_YAW_PULSE_LT ) == 1) FF3_IOM10_CH1 |= 0x0200;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_X_NORM_LT ) == 1) FF3_IOM10_CH1 |= 0x0400;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_X_PULSE_LT ) == 1) FF3_IOM10_CH1 |= 0x0800;
		if (ReadCOMPOOL_IS( SCP_AFT_BLANK_LT ) == 1) FF3_IOM10_CH1 |= 0x1000;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_Y_NORM_LT ) == 1) FF3_IOM10_CH1 |= 0x2000;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_Y_PULSE_LT ) == 1) FF3_IOM10_CH1 |= 0x4000;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_LOW_Z_LT ) == 1) FF3_IOM10_CH1 |= 0x8000;

		unsigned short FF3_IOM10_CH2 = 0;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_Z_NORM_LT ) == 1) FF3_IOM10_CH2 |= 0x0001;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_Z_PULSE_LT ) == 1) FF3_IOM10_CH2 |= 0x0002;
		if (ReadCOMPOOL_IS( SCP_AFT_TRANSL_Z_HIGH_LT ) == 1) FF3_IOM10_CH2 |= 0x0004;

		// output
		WriteCOMPOOL_IS( SCP_FF1_IOM2_CH1_DATA, ReadCOMPOOL_IS( SCP_FF1_IOM2_CH1_DATA ) | FF1_IOM2_CH1 );
		WriteCOMPOOL_IS( SCP_FF1_IOM2_CH2_DATA, ReadCOMPOOL_IS( SCP_FF1_IOM2_CH2_DATA ) | FF1_IOM2_CH2 );
		WriteCOMPOOL_IS( SCP_FF1_IOM10_CH1_DATA, ReadCOMPOOL_IS( SCP_FF1_IOM10_CH1_DATA ) | FF1_IOM10_CH1 );
		WriteCOMPOOL_IS( SCP_FF1_IOM10_CH2_DATA, ReadCOMPOOL_IS( SCP_FF1_IOM10_CH2_DATA ) | FF1_IOM10_CH2 );
		WriteCOMPOOL_IS( SCP_FF3_IOM2_CH1_DATA, ReadCOMPOOL_IS( SCP_FF3_IOM2_CH1_DATA ) | FF3_IOM2_CH1 );
		WriteCOMPOOL_IS( SCP_FF3_IOM2_CH2_DATA, ReadCOMPOOL_IS( SCP_FF3_IOM2_CH2_DATA ) | FF3_IOM2_CH2 );
		WriteCOMPOOL_IS( SCP_FF3_IOM10_CH1_DATA, ReadCOMPOOL_IS( SCP_FF3_IOM10_CH1_DATA ) | FF3_IOM10_CH1 );
		WriteCOMPOOL_IS( SCP_FF3_IOM10_CH2_DATA, ReadCOMPOOL_IS( SCP_FF3_IOM10_CH2_DATA ) | FF3_IOM10_CH2 );
		return;
	}

	bool DAPLightsDriver::OnMajorModeChange( unsigned int newMajorMode )
	{
		switch (newMajorMode)
		{
			case 103:
			case 104:
			case 105:
			case 106:
			case 201:
			case 202:
			case 301:
			case 302:
			case 303:
			case 601:
			case 801:
				return true;
			default:
				return false;
		}
	}
}